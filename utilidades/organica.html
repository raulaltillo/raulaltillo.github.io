<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz de Nomenclatura Orgánica (generador)</title>
  <style>
    :root{ --bg:#0f172a; --panel:#111827; --ink:#e5e7eb; --muted:#9ca3af; --accent:#22d3ee; --ok:#22c55e; --err:#ef4444; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial; color:var(--ink); background:linear-gradient(120deg,#0b1023,#111827 50%,#0b1023); display:flex; align-items:center; justify-content:center; padding:24px; }
    .app{ width:100%; max-width:960px; background:rgba(17,24,39,.8); backdrop-filter: blur(6px); border:1px solid #1f2937; border-radius:20px; padding:24px; box-shadow:0 20px 80px rgba(0,0,0,.35) }
    h1{ margin:0 0 8px; font-weight:800; letter-spacing:.2px }
    .sub{ color:var(--muted); margin-bottom:24px }
    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:16px }
    .card{ background:rgba(2,6,23,.6); border:1px solid #1f2937; border-radius:16px; padding:16px }
    .label{ color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.08em }
    .big{ font-size:24px; font-weight:700; margin:4px 0 0 }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace }
    input[type=text]{ width:100%; padding:12px 14px; border-radius:12px; border:1px solid #334155; background:#0b1328; color:var(--ink) }
    input[type=text]::placeholder{ color:#6b7280 }
    .row{ display:flex; gap:10px; align-items:center }
    .row.wrap{ flex-wrap:wrap }
    .btn{ appearance:none; border:none; background:var(--accent); color:#052029; font-weight:800; padding:12px 16px; border-radius:12px; cursor:pointer; transition:filter .2s }
    .btn:hover{ filter:brightness(1.05) }
    .btn.secondary{ background:#334155; color:#e5e7eb }
    .note{ color:var(--muted); font-size:13px }
    .badge{ display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; background:#0b1328; border:1px solid #1f2937; color:#a3a3a3 }
    .result{ margin-top:8px; font-weight:700 }
    .ok{ color:var(--ok) }
    .err{ color:var(--err) }
    .muted{ color:var(--muted) }
    .footer{ margin-top:16px; display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap }
    .switch{ display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none }
    .switch input{ display:none }
    .pill{ width:42px; height:24px; background:#334155; border-radius:999px; position:relative; transition:background .2s }
    .pill::after{ content:""; position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:50%; background:#e5e7eb; transition:transform .2s }
    .switch input:checked + .pill{ background:var(--accent) }
    .switch input:checked + .pill::after{ transform:translateX(18px) }
    .tiny{ font-size:12px }
    .kbd{ font-size:12px; border:1px solid #374151; background:#0b1328; padding:.2em .45em; border-radius:6px }
  </style>
</head>
<body>
  <div class="app">
    <h1>Quiz de Nomenclatura Orgánica</h1>
    <div class="sub">Generación aleatoria de compuestos (alcanos, alquenos, alcoholes, cetonas, ácidos y ésteres). El nombre se evalúa con orientación IUPAC (menor conjunto de locantes) y se omiten locantes cuando son únicos.</div>

    <div class="grid">
      <div class="card">
        <div class="label">Fórmula semidesarrollada (orientada C1 → …)</div>
        <div id="semi" class="big mono">—</div>
      </div>
      <div class="card">
        <div class="label">Datos</div>
        <div class="row wrap" style="gap:8px; margin-top:6px">
          <span class="badge" id="badgeFam">Familia: <span id="familia">—</span></span>
          <span class="badge" id="badgeFor">Fórmula: <span id="formula">—</span></span>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="label">Tu respuesta</div>
      <div class="row" style="margin-top:6px">
        <input id="respuesta" type="text" placeholder="Ej.: but-2-eno, 2-propanol, 2-metilbutano, etil etanoato" />
        <button id="btnCheck" class="btn">Comprobar</button>
        <button id="btnSkip" class="btn secondary" title="Nueva molécula (no puntúa)">Saltar</button>
      </div>
      <div id="feedback" class="result muted">—</div>
      <div id="reveal" class="note" style="display:none"></div>
    </div>

    <div class="footer">
      <div class="row tiny muted">
        <span>Marcador:</span>
        <span id="score">0</span>/<span id="tries">0</span>
      </div>
      <div class="row tiny muted">
        <label class="switch" title="Permite pequeños errores de tecleo">
          <input id="fuzzy" type="checkbox" checked>
          <span class="pill"></span>
          <span>Tolerancia a typos</span>
        </label>
        <label class="switch" title="Mostrar/ocultar la familia">
          <input id="showFam" type="checkbox">
          <span class="pill"></span>
          <span>Mostrar familia</span>
        </label>
        <label class="switch" title="Mostrar/ocultar la fórmula molecular">
          <input id="showFor" type="checkbox">
          <span class="pill"></span>
          <span>Mostrar fórmula</span>
        </label>
      </div>
    </div>
  </div>

  <script>
    // ===== Utilidades =====
    const PREFIJOS = {1:"met",2:"et",3:"prop",4:"but",5:"pent",6:"hex",7:"hept",8:"oct",9:"non",10:"dec"};
    const SUBS_NOMBRE = {1:"metil", 2:"etil"};
    const FAMILIAS = ["alcano","alqueno","alcohol","cetona","acido","ester"];

    const r = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
    const choice = arr => arr[Math.floor(Math.random()*arr.length)];
    function nombreCadena(n){return PREFIJOS[n] || `C${n}`}

    function normalizeName(s){
      return s.toLowerCase()
        .replaceAll(/[\s–—]/g,"-")
        .replaceAll("ácido","acido")
        .normalize('NFD').replace(/[\u0300-\u036f]/g,"") // sin acentos
        .replaceAll(/-{2,}/g,"-")
        .replace(/^-|-$|\.|,/g,"");
    }

    // Levenshtein para tolerancia a typos
    function lev(a,b){
      const m=a.length, n=b.length; if(!m) return n; if(!n) return m;
      const dp=Array.from({length:m+1},(_,i)=>Array(n+1).fill(0));
      for(let i=0;i<=m;i++) dp[i][0]=i; for(let j=0;j<=n;j++) dp[0][j]=j;
      for(let i=1;i<=m;i++) for(let j=1;j<=n;j++){
        const cost=a[i-1]===b[j-1]?0:1;
        dp[i][j]=Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost);
      }
      return dp[m][n];
    }

    function rndExcluding(low, high, excluded){
      const opts=[]; for(let i=low;i<=high;i++) if(!excluded.includes(i)) opts.push(i);
      return opts.length? choice(opts): null;
    }

    // ===== Semidesarrolladas =====
    function semiAlcano(n, sub){
      let base;
      if(n===1) base=["CH4"]; else if(n===2) base=["CH3","CH3"]; else base=["CH3", ...Array(n-2).fill("CH2"), "CH3"];
      if(sub){
        const [pos,tam]=sub, idx=pos-1; let frag=base[idx];
        if(frag==="CH3"||frag==="CH2") frag="CH";
        const rama = (tam===1?"(CH3)":"(CH2CH3)");
        base[idx]=frag+rama;
      }
      return base.join("-");
    }

    function semiAlqueno(n,posDoble,sub){
      const u=[];
      for(let i=1;i<=n;i++){
        let frag = (i===1||i===n)?"CH3":"CH2";
        if(i===posDoble||i===posDoble+1){ frag = (i===1||i===n)?"CH2":"CH"; }
        u.push(frag);
      }
      if(sub){
        const [p,tam]=sub, idx=p-1; let frag=u[idx];
        if(frag==="CH3"||frag==="CH2"||frag==="CHOH"||frag==="CH") frag="CH";
        u[idx]=frag+(tam===1?"(CH3)":"(CH2CH3)");
      }
      const partes=[]; for(let i=0;i<n;i++){partes.push(u[i]); if(i===posDoble-1) partes.push("="); else if(i<n-1) partes.push("-");}
      return partes.join("");
    }

    function semiAlcohol(n,posOH,sub){
      if(n===1) return "CH3-OH";
      const base=["CH3", ...Array(n-2).fill("CH2"), "CH3"]; const idx=posOH-1;
      base[idx] = (idx===0||idx===n-1)?"CH2OH":"CHOH";
      if(sub){
        const [p,tam]=sub, pidx=p-1; if(pidx!==idx){
          let frag=base[pidx]; if(frag==="CH3"||frag==="CH2"||frag==="CHOH") frag="CH"; base[pidx]=frag+(tam===1?"(CH3)":"(CH2CH3)");
        }
      }
      return base.join("-");
    }

    function semiCetona(n,pos){
      // butan-2-ona -> CH3-CO-CH2-CH3 (orientada con C1 a la izquierda)
      const left = pos; const right=n-left;
      const parts=[];
      if(left===1){parts.push("CO");}
      else if(left===2){parts.push("CH3","-","CO");}
      else {parts.push("CH3"); for(let i=0;i<left-2;i++) parts.push("-","CH2"); parts.push("-","CO");}
      if(right>=1){ if(right===1) parts.push("-","CH3"); else {parts.push("-","CH2"); for(let i=0;i<right-2;i++) parts.push("-","CH2"); parts.push("-","CH3");} }
      return parts.join("");
    }

    function semiAcido(n){
      // Mostrar carboxilo a la izquierda para que C1 esté a la izquierda: HOOC-...
      if(n===1) return "HOOC-H";
      if(n===2) return "HOOC-CH3";
      return "HOOC-"+Array(n-1).fill("CH2").slice(0,n-2).join("-")+(n>2? (n-2>0?"-":"")+"CH3":"");
    }

    function semiEster(nAc,nAl){
      // Acilo a la izquierda (C=O como C1): R-COO-R'
      let acilo = nAc===1?"H-COO-":(nAc===2?"CH3-COO-":"CH3-"+Array(nAc-2).fill("CH2").join("-")+"-COO-");
      if(nAl===1) return acilo+"CH3"; if(nAl===2) return acilo+"CH2-CH3"; return acilo+"CH3-"+Array(nAl-1).fill("CH2").join("-");
    }

    // ===== Nombres (con orientación y supresión de locantes cuando procede) =====
    function nombreAlcano(n,sub){
      if(!sub) return nombreCadena(n)+"ano";
      const [pos,tam]=sub; return `${pos}-${SUBS_NOMBRE[tam]}${nombreCadena(n)}ano`;
    }

    function nombreAlqueno(n,posDoble,sub){
      // Omitir locante del doble enlace sólo si n<=3 (único posible)
      const base = (n<=3) ? `${nombreCadena(n)}eno` : `${nombreCadena(n)}-${posDoble}-eno`;
      if(!sub) return base;
      const [p,tam]=sub; return `${p}-${SUBS_NOMBRE[tam]}${base}`;
    }

    function nombreAlcohol(n,posOH,sub){
      // Omitir locante del OH si n<=2 (único posible)
      const base = (n<=2) ? `${nombreCadena(n)}anol` : `${nombreCadena(n)}an-${posOH}-ol`;
      if(!sub) return base;
      const [p,tam]=sub; return `${p}-${SUBS_NOMBRE[tam]}${base}`;
    }

    function nombreCetona(n,pos){
      // Posición única si n=3 o n=4 -> omitir locante
      const unico = (n===3) || (n===4);
      return unico? `${nombreCadena(n)}anona` : `${nombreCadena(n)}an-${pos}-ona`;
    }

    function nombreAcido(n){ return `acido ${nombreCadena(n)}anoico`; }
    function nombreEster(nAc,nAl){ return `${nombreCadena(nAl)}il ${nombreCadena(nAc)}anoato`; }

    // ===== Fórmulas moleculares (aprox) =====
    function formulaMol(fam, n, sub, extra){
      function satC(n){return [n, 2*n+2]}
      if(fam==="alcano"){ const carb = n + (sub? sub[1]:0); const [c,h]=satC(carb); return `C${c}H${h}`; }
      if(fam==="alqueno"){ const carb = n + (sub? sub[1]:0); return `C${carb}H${2*carb}`; }
      if(fam==="alcohol"){ const carb = n + (sub? sub[1]:0); return `C${carb}H${2*carb+2}O`; }
      if(fam==="cetona"){ return `C${n}H${2*n}O`; }
      if(fam==="acido"){ return `C${n}H${2*n}O2`; }
      if(fam==="ester"){ const [nAc,nAl]=extra; const carb=nAc+nAl; return `C${carb}H${2*carb}O2`; }
      return "?";
    }

    // ===== Orientación para menor conjunto de locantes =====
    function orientAlcano(n, sub){
      if(!sub) return {sub:null, flipped:false};
      const [p,t]=sub; const q = n+1-p; // espejo
      if(q < p) return {sub:[q,t], flipped:true};
      return {sub:[p,t], flipped:false};
    }

    function orientAlqueno(n, d, sub){
      // Compara (d, s) vs (n-d, n+1-s) lexicográficamente
      const candA = [d, sub? sub[0]:Infinity];
      const candB = [n-d, sub? (n+1-sub[0]):Infinity];
      const useB = (candB[0] < candA[0]) || (candB[0]===candA[0] && candB[1] < candA[1]);
      if(useB){ return {d:n-d, sub: sub? [n+1-sub[0], sub[1]]: null, flipped:true}; }
      return {d, sub, flipped:false};
    }

    function orientAlcohol(n, pOH, sub){
      const candA = [pOH, sub? sub[0]:Infinity];
      const candB = [n+1-pOH, sub? (n+1-sub[0]):Infinity];
      const useB = (candB[0] < candA[0]) || (candB[0]===candA[0] && candB[1] < candA[1]);
      if(useB){ return {pOH:n+1-pOH, sub: sub? [n+1-sub[0], sub[1]]: null, flipped:true}; }
      return {pOH, sub, flipped:false};
    }

    function orientCetona(n, pos){
      const alt = n - pos; // espejo
      if(alt < pos) return {pos:alt, flipped:true};
      return {pos, flipped:false};
    }

    // ===== Generadores =====
    function genAlcano(){
      const n=r(2,8); let sub=null; if(n>=3 && Math.random()<0.6){ sub=[rndExcluding(2,n-1,[]), choice([1,2])] }
      const o = orientAlcano(n, sub);
      const nombre=nombreAlcano(n,o.sub); const semi=semiAlcano(n,o.sub); const formula=formulaMol("alcano",n,o.sub);
      return {familia:"alcano", nombre, semi, formula, meta:{n, sub:o.sub}};
    }

    function genAlqueno(){
      const n=r(2,8); let d=r(1,n-1); if(n>=4 && (d===1||d===n-1) && Math.random()<0.5) d=r(2,n-2);
      let sub=null; if(n>=4 && Math.random()<0.45){ sub=[rndExcluding(2,n-1,[]), choice([1,2])]; }
      const o = orientAlqueno(n,d,sub);
      const nombre=nombreAlqueno(n,o.d,o.sub); const semi=semiAlqueno(n,o.d,o.sub); const formula=formulaMol("alqueno",n,o.sub);
      return {familia:"alqueno", nombre, semi, formula, meta:{n, d:o.d, sub:o.sub}};
    }

    function genAlcohol(){
      const n=r(1,8); const pOH=(n===1)?1:r(1,n); let sub=null; if(n>=4 && Math.random()<0.4){ const p=rndExcluding(2,n-1,[pOH]); if(p) sub=[p, choice([1,2])]; }
      const o = orientAlcohol(n,pOH,sub);
      const nombre=nombreAlcohol(n,o.pOH,o.sub); const semi=semiAlcohol(n,o.pOH,o.sub); const formula=formulaMol("alcohol",n,o.sub);
      return {familia:"alcohol", nombre, semi, formula, meta:{n, pOH:o.pOH, sub:o.sub}};
    }

    function genCetona(){
      const n=r(3,8); let pos=(n>=4)? r(2,n-2):1; const o=orientCetona(n,pos);
      const nombre=nombreCetona(n,o.pos); const semi=semiCetona(n,o.pos); const formula=formulaMol("cetona",n);
      return {familia:"cetona", nombre, semi, formula, meta:{n, pos:o.pos}};
    }

    function genAcido(){
      const n=r(1,8); const nombre=nombreAcido(n); const semi=semiAcido(n); const formula=formulaMol("acido",n);
      return {familia:"acido", nombre, semi, formula, meta:{n}};
    }

    function genEster(){
      const nAc=r(1,8), nAl=r(1,6); const nombre=nombreEster(nAc,nAl); const semi=semiEster(nAc,nAl); const formula=formulaMol("ester",null,null,[nAc,nAl]);
      return {familia:"ester", nombre, semi, formula, meta:{nAc, nAl}};
    }

    function genCompuesto(){
      switch(choice(FAMILIAS)){
        case "alcano": return genAlcano();
        case "alqueno": return genAlqueno();
        case "alcohol": return genAlcohol();
        case "cetona": return genCetona();
        case "acido": return genAcido();
        case "ester": return genEster();
      }
    }

    // ===== Variantes aceptadas (locante opcional y forma prefijada 2-buteno) =====
    function altPrefijada(nombre){
      // Convierte "but-2-eno" -> "2-buteno" ; "propan-2-ol" -> "2-propanol" ; mantiene sustituyentes al inicio
      const s = nombre;
      // alcohol
      let m = s.match(/^(.*?)([a-z]+)an-(\d+)-ol$/); // ej: propan-2-ol
      if(m){ const base=m[1]+m[2]+"anol"; return `${m[3]}-${base}`; }
      // alqueno
      m = s.match(/^([a-z]+)-(\d+)-eno$/); // but-2-eno
      if(m){ return `${m[2]}-${m[1]}eno`; }
      // cetona con locante
      m = s.match(/^([a-z]+)an-(\d+)-ona$/);
      if(m){ return `${m[2]}-${m[1]}anona`; }
      return s;
    }

    function nombresAceptados(comp){
      const canonical = comp.nombre;
      const acc = new Set();
      acc.add(normalizeName(canonical));
      // Variante prefijada (2-buteno, 2-propanol, 2-butanona)
      acc.add(normalizeName(altPrefijada(canonical)));

      // Si el locante es prescindible, añadimos versión sin locante
      if(comp.familia==="alqueno"){
        const n = comp.meta.n; if(n<=3){ acc.add(normalizeName(`${nombreCadena(n)}eno`)); }
      }
      if(comp.familia==="alcohol"){
        const n = comp.meta.n; if(n<=2){ acc.add(normalizeName(`${nombreCadena(n)}anol`)); }
      }
      if(comp.familia==="cetona"){
        const n = comp.meta.n; if(n && (n===3||n===4)){ acc.add(normalizeName(`${nombreCadena(n)}anona`)); }
      }
      return acc;
    }

    // ===== Quiz Logic =====
    let current=null, score=0, tries=0;
    const elSemi=document.getElementById('semi');
    const elFam=document.getElementById('familia');
    const elFormula=document.getElementById('formula');
    const elBadgeFam=document.getElementById('badgeFam');
    const elBadgeFor=document.getElementById('badgeFor');
    const elAns=document.getElementById('respuesta');
    const elFeedback=document.getElementById('feedback');
    const elReveal=document.getElementById('reveal');
    const elScore=document.getElementById('score');
    const elTries=document.getElementById('tries');
    const btnCheck=document.getElementById('btnCheck');
    const btnSkip=document.getElementById('btnSkip');
    const chkFuzzy=document.getElementById('fuzzy');
    const chkShowFam=document.getElementById('showFam');
    const chkShowFor=document.getElementById('showFor');

    function renderNew(){
      current = genCompuesto();
      elSemi.textContent = current.semi;
      elFam.textContent = current.familia;
      elFormula.textContent = current.formula;
      elFeedback.textContent = '—'; elFeedback.className='result muted';
      elReveal.style.display='none'; elReveal.textContent='';
      elAns.value=''; elAns.focus();
      // aplicar visibilidad
      elBadgeFam.style.display = chkShowFam.checked? 'inline-block':'none';
      elBadgeFor.style.display = chkShowFor.checked? 'inline-block':'none';
    }

    function check(){
      const userRaw = elAns.value.trim(); if(!userRaw) return;
      const user = normalizeName(userRaw);
      const accepted = nombresAceptados(current);

      let correct = accepted.has(user);
      if(!correct && chkFuzzy.checked){
        // distancia mínima contra cualquiera de los aceptados
        let minD = Infinity; for(const a of accepted){ const d=lev(user,a); if(d<minD) minD=d; }
        const expLen = Math.min(...Array.from(accepted).map(a=>a.length));
        correct = minD <= Math.max(2, Math.ceil(expLen*0.15));
      }

      tries++; if(correct) score++;
      elScore.textContent = String(score); elTries.textContent = String(tries);

      if(correct){
        elFeedback.textContent = '✅ ¡Correcto!'; elFeedback.className='result ok';
        elReveal.style.display='block'; elReveal.textContent = `Nombre esperado: ${current.nombre}`;
        setTimeout(renderNew, 900);
      } else {
        elFeedback.textContent = '❌ Incorrecto'; elFeedback.className='result err';
        elReveal.style.display='block'; elReveal.textContent = `Solución: ${current.nombre}`;
      }
    }

    btnCheck.addEventListener('click', check);
    btnSkip.addEventListener('click', renderNew);
    elAns.addEventListener('keydown', e=>{ if(e.key==='Enter') check(); });
    chkShowFam.addEventListener('change', ()=>{ elBadgeFam.style.display = chkShowFam.checked? 'inline-block':'none'; });
    chkShowFor.addEventListener('change', ()=>{ elBadgeFor.style.display = chkShowFor.checked? 'inline-block':'none'; });

    renderNew();
  </script>
</body>
</html>
